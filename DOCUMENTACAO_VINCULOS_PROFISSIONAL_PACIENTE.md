# ðŸ“‹ DocumentaÃ§Ã£o - Sistema de VÃ­nculos Profissional-Paciente

## ðŸŽ¯ VisÃ£o Geral

O sistema de vÃ­nculos permite que mÃºltiplos profissionais atendam um paciente e que um profissional atenda mÃºltiplos pacientes. Cada vÃ­nculo representa uma relaÃ§Ã£o terapÃªutica especÃ­fica com tipo de atendimento, frequÃªncia e configuraÃ§Ãµes prÃ³prias.

## ðŸ“Š Estrutura do Banco de Dados

### Tabela: `profissional_paciente`

| Campo | Tipo | DescriÃ§Ã£o |
|-------|------|-----------|
| `id` | Integer | ID Ãºnico do vÃ­nculo |
| `profissional_id` | Integer | ID do profissional (FK) |
| `paciente_id` | Integer | ID do paciente (FK) |
| `data_inicio` | Date | Data de inÃ­cio do atendimento |
| `data_fim` | Date | Data de fim do atendimento (opcional) |
| `status` | Enum | Status do vÃ­nculo (ATIVO, INATIVO, SUSPENSO) |
| `tipo_atendimento` | Enum | Tipo de terapia/atendimento |
| `frequencia_semanal` | Integer | NÃºmero de sessÃµes por semana |
| `duracao_sessao` | Integer | DuraÃ§Ã£o da sessÃ£o em minutos |
| `observacoes` | Text | ObservaÃ§Ãµes sobre o atendimento |
| `data_criacao` | Date | Data de criaÃ§Ã£o do registro |
| `criado_por` | Integer | ID do usuÃ¡rio que criou (FK) |

### Enums DisponÃ­veis

#### StatusVinculoEnum
- `ATIVO` - VÃ­nculo ativo
- `INATIVO` - VÃ­nculo encerrado
- `SUSPENSO` - VÃ­nculo temporariamente suspenso

#### TipoAtendimentoEnum
- `Terapia ABA` - AnÃ¡lise do Comportamento Aplicada
- `Psicologia` - Atendimento psicolÃ³gico
- `Fonoaudiologia` - Terapia da fala
- `Terapia Ocupacional` - Terapia ocupacional
- `Fisioterapia` - Fisioterapia
- `Psicopedagogia` - Psicopedagogia
- `Outro` - Outros tipos de atendimento

## ðŸ”— Endpoints da API

### 1. Listar VÃ­nculos
```http
GET /api/vinculos
```

**ParÃ¢metros de Query:**
- `status` (opcional): Filtrar por status (ATIVO, INATIVO, SUSPENSO)
- `profissional_id` (opcional): Filtrar por ID do profissional
- `paciente_id` (opcional): Filtrar por ID do paciente
- `tipo_atendimento` (opcional): Filtrar por tipo de atendimento

**Exemplo de Resposta:**
```json
[
  {
    "id": 1,
    "profissional": {
      "id": 1,
      "nome": "Dr. JoÃ£o Silva",
      "especialidade": "Terapia ABA",
      "email": "joao.silva@clinica.com",
      "telefone": "(11) 99999-1111"
    },
    "paciente": {
      "id": 1,
      "nome": "Ana Clara Oliveira",
      "data_nascimento": "2018-05-15",
      "idade": 6,
      "responsavel": "Carlos Oliveira",
      "contato": "(11) 99999-4444",
      "diagnostico": "TEA"
    },
    "data_inicio": "2024-09-02",
    "data_fim": null,
    "status": "ATIVO",
    "tipo_atendimento": "Terapia ABA",
    "frequencia_semanal": 3,
    "duracao_sessao": 60,
    "observacoes": "Paciente com boa evoluÃ§Ã£o na comunicaÃ§Ã£o",
    "data_criacao": "2024-10-02",
    "criado_por": 7
  }
]
```

### 2. Obter VÃ­nculo EspecÃ­fico
```http
GET /api/vinculos/{vinculo_id}
```

**Exemplo de Resposta:**
```json
{
  "id": 1,
  "profissional": {
    "id": 1,
    "nome": "Dr. JoÃ£o Silva",
    "especialidade": "Terapia ABA",
    "email": "joao.silva@clinica.com",
    "telefone": "(11) 99999-1111"
  },
  "paciente": {
    "id": 1,
    "nome": "Ana Clara Oliveira",
    "data_nascimento": "2018-05-15",
    "idade": 6,
    "responsavel": "Carlos Oliveira",
    "contato": "(11) 99999-4444",
    "diagnostico": "TEA"
  },
  "data_inicio": "2024-09-02",
  "data_fim": null,
  "status": "ATIVO",
  "tipo_atendimento": "Terapia ABA",
  "frequencia_semanal": 3,
  "duracao_sessao": 60,
  "observacoes": "Paciente com boa evoluÃ§Ã£o na comunicaÃ§Ã£o",
  "data_criacao": "2024-10-02",
  "criado_por": 7
}
```

### 3. Criar Novo VÃ­nculo
```http
POST /api/vinculos
```

**Payload de Exemplo:**
```json
{
  "profissional_id": 1,
  "paciente_id": 2,
  "tipo_atendimento": "Psicologia",
  "data_inicio": "2024-10-02",
  "frequencia_semanal": 2,
  "duracao_sessao": 45,
  "observacoes": "Foco em habilidades sociais e comunicaÃ§Ã£o",
  "criado_por": 7
}
```

**Resposta de Sucesso (201):**
```json
{
  "id": 8,
  "profissional": {
    "id": 1,
    "nome": "Dr. JoÃ£o Silva",
    "especialidade": "Terapia ABA",
    "email": "joao.silva@clinica.com",
    "telefone": "(11) 99999-1111"
  },
  "paciente": {
    "id": 2,
    "nome": "Lucas Ferreira",
    "data_nascimento": "2017-08-22",
    "idade": 7,
    "responsavel": "Sandra Ferreira",
    "contato": "(11) 99999-5555",
    "diagnostico": "TEA"
  },
  "data_inicio": "2024-10-02",
  "data_fim": null,
  "status": "ATIVO",
  "tipo_atendimento": "Psicologia",
  "frequencia_semanal": 2,
  "duracao_sessao": 45,
  "observacoes": "Foco em habilidades sociais e comunicaÃ§Ã£o",
  "data_criacao": "2024-10-02",
  "criado_por": 7
}
```

### 4. Atualizar VÃ­nculo
```http
PUT /api/vinculos/{vinculo_id}
```

**Payload de Exemplo:**
```json
{
  "status": "SUSPENSO",
  "frequencia_semanal": 1,
  "observacoes": "Atendimento suspenso temporariamente por motivos familiares"
}
```

### 5. Ativar VÃ­nculo
```http
POST /api/vinculos/{vinculo_id}/ativar
```

### 6. Inativar VÃ­nculo
```http
POST /api/vinculos/{vinculo_id}/inativar
```

**Payload Opcional:**
```json
{
  "data_fim": "2024-12-31"
}
```

### 7. Suspender VÃ­nculo
```http
POST /api/vinculos/{vinculo_id}/suspender
```

### 8. Listar Pacientes de um Profissional
```http
GET /api/profissionais/{profissional_id}/pacientes
```

**ParÃ¢metros de Query:**
- `apenas_ativos` (opcional): true/false (padrÃ£o: true)

**Exemplo de Resposta:**
```json
[
  {
    "id": 1,
    "profissional": {
      "id": 1,
      "nome": "Dr. JoÃ£o Silva",
      "especialidade": "Terapia ABA",
      "email": "joao.silva@clinica.com",
      "telefone": "(11) 99999-1111"
    },
    "paciente": {
      "id": 1,
      "nome": "Ana Clara Oliveira",
      "data_nascimento": "2018-05-15",
      "idade": 6,
      "responsavel": "Carlos Oliveira",
      "contato": "(11) 99999-4444",
      "diagnostico": "TEA"
    },
    "data_inicio": "2024-09-02",
    "data_fim": null,
    "status": "ATIVO",
    "tipo_atendimento": "Terapia ABA",
    "frequencia_semanal": 3,
    "duracao_sessao": 60,
    "observacoes": "Paciente com boa evoluÃ§Ã£o na comunicaÃ§Ã£o",
    "data_criacao": "2024-10-02",
    "criado_por": 7
  },
  {
    "id": 5,
    "profissional": {
      "id": 1,
      "nome": "Dr. JoÃ£o Silva",
      "especialidade": "Terapia ABA",
      "email": "joao.silva@clinica.com",
      "telefone": "(11) 99999-1111"
    },
    "paciente": {
      "id": 3,
      "nome": "Sophia Rodrigues",
      "data_nascimento": "2019-03-10",
      "idade": 5,
      "responsavel": "Roberto Rodrigues",
      "contato": "(11) 99999-6666",
      "diagnostico": "TEA"
    },
    "data_inicio": "2024-09-22",
    "data_fim": null,
    "status": "ATIVO",
    "tipo_atendimento": "Terapia ABA",
    "frequencia_semanal": 4,
    "duracao_sessao": 45,
    "observacoes": "Paciente iniciante, adaptaÃ§Ã£o ao ambiente",
    "data_criacao": "2024-10-02",
    "criado_por": 7
  }
]
```

### 9. Listar Profissionais de um Paciente
```http
GET /api/pacientes/{paciente_id}/profissionais
```

**ParÃ¢metros de Query:**
- `apenas_ativos` (opcional): true/false (padrÃ£o: true)

**Exemplo de Resposta:**
```json
[
  {
    "id": 1,
    "profissional": {
      "id": 1,
      "nome": "Dr. JoÃ£o Silva",
      "especialidade": "Terapia ABA",
      "email": "joao.silva@clinica.com",
      "telefone": "(11) 99999-1111"
    },
    "paciente": {
      "id": 1,
      "nome": "Ana Clara Oliveira",
      "data_nascimento": "2018-05-15",
      "idade": 6,
      "responsavel": "Carlos Oliveira",
      "contato": "(11) 99999-4444",
      "diagnostico": "TEA"
    },
    "data_inicio": "2024-09-02",
    "data_fim": null,
    "status": "ATIVO",
    "tipo_atendimento": "Terapia ABA",
    "frequencia_semanal": 3,
    "duracao_sessao": 60,
    "observacoes": "Paciente com boa evoluÃ§Ã£o na comunicaÃ§Ã£o",
    "data_criacao": "2024-10-02",
    "criado_por": 7
  },
  {
    "id": 2,
    "profissional": {
      "id": 2,
      "nome": "Dra. Maria Santos",
      "especialidade": "Psicologia Comportamental",
      "email": "maria.santos@clinica.com",
      "telefone": "(11) 99999-2222"
    },
    "paciente": {
      "id": 1,
      "nome": "Ana Clara Oliveira",
      "data_nascimento": "2018-05-15",
      "idade": 6,
      "responsavel": "Carlos Oliveira",
      "contato": "(11) 99999-4444",
      "diagnostico": "TEA"
    },
    "data_inicio": "2024-09-12",
    "data_fim": null,
    "status": "ATIVO",
    "tipo_atendimento": "Psicologia",
    "frequencia_semanal": 2,
    "duracao_sessao": 45,
    "observacoes": "Trabalho focado em habilidades sociais",
    "data_criacao": "2024-10-02",
    "criado_por": 7
  }
]
```

## ðŸŽ¨ Exemplos para Frontend

### 1. Componente de Lista de VÃ­nculos

```javascript
// Buscar vÃ­nculos de um paciente
const fetchVinculosPaciente = async (pacienteId) => {
  try {
    const response = await fetch(`/api/pacientes/${pacienteId}/profissionais`);
    const vinculos = await response.json();
    return vinculos;
  } catch (error) {
    console.error('Erro ao buscar vÃ­nculos:', error);
  }
};

// Exemplo de uso no React
const VinculosPaciente = ({ pacienteId }) => {
  const [vinculos, setVinculos] = useState([]);
  
  useEffect(() => {
    fetchVinculosPaciente(pacienteId).then(setVinculos);
  }, [pacienteId]);
  
  return (
    <div className="vinculos-container">
      <h3>Profissionais Vinculados</h3>
      {vinculos.map(vinculo => (
        <div key={vinculo.id} className="vinculo-card">
          <h4>{vinculo.profissional.nome}</h4>
          <p><strong>Especialidade:</strong> {vinculo.profissional.especialidade}</p>
          <p><strong>Tipo de Atendimento:</strong> {vinculo.tipo_atendimento}</p>
          <p><strong>FrequÃªncia:</strong> {vinculo.frequencia_semanal}x por semana</p>
          <p><strong>DuraÃ§Ã£o:</strong> {vinculo.duracao_sessao} minutos</p>
          <p><strong>Status:</strong> 
            <span className={`status ${vinculo.status.toLowerCase()}`}>
              {vinculo.status}
            </span>
          </p>
          {vinculo.observacoes && (
            <p><strong>ObservaÃ§Ãµes:</strong> {vinculo.observacoes}</p>
          )}
        </div>
      ))}
    </div>
  );
};
```

### 2. FormulÃ¡rio de CriaÃ§Ã£o de VÃ­nculo

```javascript
const FormularioVinculo = ({ onSuccess }) => {
  const [formData, setFormData] = useState({
    profissional_id: '',
    paciente_id: '',
    tipo_atendimento: '',
    data_inicio: new Date().toISOString().split('T')[0],
    frequencia_semanal: 1,
    duracao_sessao: 45,
    observacoes: ''
  });
  
  const tiposAtendimento = [
    'Terapia ABA',
    'Psicologia',
    'Fonoaudiologia',
    'Terapia Ocupacional',
    'Fisioterapia',
    'Psicopedagogia',
    'Outro'
  ];
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      const response = await fetch('/api/vinculos', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });
      
      if (response.ok) {
        const novoVinculo = await response.json();
        onSuccess(novoVinculo);
        // Reset form
        setFormData({
          profissional_id: '',
          paciente_id: '',
          tipo_atendimento: '',
          data_inicio: new Date().toISOString().split('T')[0],
          frequencia_semanal: 1,
          duracao_sessao: 45,
          observacoes: ''
        });
      } else {
        const error = await response.json();
        alert(`Erro: ${error.erro}`);
      }
    } catch (error) {
      console.error('Erro ao criar vÃ­nculo:', error);
      alert('Erro ao criar vÃ­nculo');
    }
  };
  
  return (
    <form onSubmit={handleSubmit} className="formulario-vinculo">
      <h3>Criar Novo VÃ­nculo</h3>
      
      <div className="form-group">
        <label>Profissional:</label>
        <select 
          value={formData.profissional_id}
          onChange={(e) => setFormData({...formData, profissional_id: e.target.value})}
          required
        >
          <option value="">Selecione um profissional</option>
          {/* Carregar profissionais dinamicamente */}
        </select>
      </div>
      
      <div className="form-group">
        <label>Paciente:</label>
        <select 
          value={formData.paciente_id}
          onChange={(e) => setFormData({...formData, paciente_id: e.target.value})}
          required
        >
          <option value="">Selecione um paciente</option>
          {/* Carregar pacientes dinamicamente */}
        </select>
      </div>
      
      <div className="form-group">
        <label>Tipo de Atendimento:</label>
        <select 
          value={formData.tipo_atendimento}
          onChange={(e) => setFormData({...formData, tipo_atendimento: e.target.value})}
          required
        >
          <option value="">Selecione o tipo</option>
          {tiposAtendimento.map(tipo => (
            <option key={tipo} value={tipo}>{tipo}</option>
          ))}
        </select>
      </div>
      
      <div className="form-group">
        <label>Data de InÃ­cio:</label>
        <input 
          type="date"
          value={formData.data_inicio}
          onChange={(e) => setFormData({...formData, data_inicio: e.target.value})}
          required
        />
      </div>
      
      <div className="form-row">
        <div className="form-group">
          <label>FrequÃªncia Semanal:</label>
          <input 
            type="number"
            min="1"
            max="7"
            value={formData.frequencia_semanal}
            onChange={(e) => setFormData({...formData, frequencia_semanal: parseInt(e.target.value)})}
          />
        </div>
        
        <div className="form-group">
          <label>DuraÃ§Ã£o da SessÃ£o (min):</label>
          <input 
            type="number"
            min="15"
            max="180"
            step="15"
            value={formData.duracao_sessao}
            onChange={(e) => setFormData({...formData, duracao_sessao: parseInt(e.target.value)})}
          />
        </div>
      </div>
      
      <div className="form-group">
        <label>ObservaÃ§Ãµes:</label>
        <textarea 
          value={formData.observacoes}
          onChange={(e) => setFormData({...formData, observacoes: e.target.value})}
          rows="3"
          placeholder="ObservaÃ§Ãµes sobre o atendimento..."
        />
      </div>
      
      <button type="submit" className="btn-primary">
        Criar VÃ­nculo
      </button>
    </form>
  );
};
```

### 3. Dashboard de Profissional

```javascript
const DashboardProfissional = ({ profissionalId }) => {
  const [pacientes, setPacientes] = useState([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const fetchPacientes = async () => {
      try {
        const response = await fetch(`/api/profissionais/${profissionalId}/pacientes`);
        const data = await response.json();
        setPacientes(data);
      } catch (error) {
        console.error('Erro ao carregar pacientes:', error);
      } finally {
        setLoading(false);
      }
    };
    
    fetchPacientes();
  }, [profissionalId]);
  
  if (loading) return <div>Carregando...</div>;
  
  return (
    <div className="dashboard-profissional">
      <h2>Meus Pacientes</h2>
      
      <div className="estatisticas">
        <div className="stat-card">
          <h3>{pacientes.length}</h3>
          <p>Pacientes Ativos</p>
        </div>
        <div className="stat-card">
          <h3>{pacientes.reduce((sum, p) => sum + p.frequencia_semanal, 0)}</h3>
          <p>SessÃµes por Semana</p>
        </div>
      </div>
      
      <div className="pacientes-grid">
        {pacientes.map(vinculo => (
          <div key={vinculo.id} className="paciente-card">
            <h4>{vinculo.paciente.nome}</h4>
            <p><strong>Idade:</strong> {vinculo.paciente.idade} anos</p>
            <p><strong>DiagnÃ³stico:</strong> {vinculo.paciente.diagnostico}</p>
            <p><strong>Tipo:</strong> {vinculo.tipo_atendimento}</p>
            <p><strong>FrequÃªncia:</strong> {vinculo.frequencia_semanal}x/semana</p>
            <p><strong>DuraÃ§Ã£o:</strong> {vinculo.duracao_sessao}min</p>
            
            <div className="acoes">
              <button onClick={() => editarVinculo(vinculo.id)}>
                Editar
              </button>
              <button onClick={() => verDetalhes(vinculo.paciente.id)}>
                Ver Detalhes
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

## ðŸ”’ ValidaÃ§Ãµes e Regras de NegÃ³cio

### ValidaÃ§Ãµes AutomÃ¡ticas:
1. **Unicidade**: NÃ£o pode haver dois vÃ­nculos ativos do mesmo tipo entre o mesmo profissional e paciente
2. **Profissional Existente**: O profissional deve existir no sistema
3. **Paciente Existente**: O paciente deve existir no sistema
4. **Tipo de Atendimento**: Deve ser um dos valores vÃ¡lidos do enum
5. **Data de InÃ­cio**: NÃ£o pode ser no futuro (opcional)
6. **FrequÃªncia**: Deve ser entre 1 e 7 sessÃµes por semana
7. **DuraÃ§Ã£o**: Deve ser entre 15 e 180 minutos

### Regras de Status:
- **ATIVO**: VÃ­nculo em funcionamento normal
- **SUSPENSO**: Temporariamente interrompido, pode ser reativado
- **INATIVO**: Encerrado definitivamente, requer data_fim

## ðŸš€ Como Implementar no Frontend

### 1. Instalar dependÃªncias (se usando React)
```bash
npm install axios react-query
```

### 2. Criar serviÃ§o de API
```javascript
// services/vinculosAPI.js
import axios from 'axios';

const API_BASE = '/api';

export const vinculosAPI = {
  listar: (filtros = {}) => 
    axios.get(`${API_BASE}/vinculos`, { params: filtros }),
    
  obter: (id) => 
    axios.get(`${API_BASE}/vinculos/${id}`),
    
  criar: (dados) => 
    axios.post(`${API_BASE}/vinculos`, dados),
    
  atualizar: (id, dados) => 
    axios.put(`${API_BASE}/vinculos/${id}`, dados),
    
  ativar: (id) => 
    axios.post(`${API_BASE}/vinculos/${id}/ativar`),
    
  inativar: (id, dataFim = null) => 
    axios.post(`${API_BASE}/vinculos/${id}/inativar`, { data_fim: dataFim }),
    
  suspender: (id) => 
    axios.post(`${API_BASE}/vinculos/${id}/suspender`),
    
  pacientesProfissional: (profissionalId, apenasAtivos = true) => 
    axios.get(`${API_BASE}/profissionais/${profissionalId}/pacientes`, {
      params: { apenas_ativos: apenasAtivos }
    }),
    
  profissionaisPaciente: (pacienteId, apenasAtivos = true) => 
    axios.get(`${API_BASE}/pacientes/${pacienteId}/profissionais`, {
      params: { apenas_ativos: apenasAtivos }
    })
};
```

### 3. Implementar no seu sistema
1. Copie os exemplos de componentes acima
2. Adapte o CSS conforme seu design system
3. Integre com seu sistema de autenticaÃ§Ã£o
4. Adicione validaÃ§Ãµes de permissÃ£o conforme necessÃ¡rio
5. Implemente notificaÃ§Ãµes de sucesso/erro

## ðŸ“± ConsideraÃ§Ãµes para Mobile

Para aplicaÃ§Ãµes mobile, considere:
- Usar cards compactos para listar vÃ­nculos
- Implementar pull-to-refresh
- Adicionar filtros rÃ¡pidos (status, tipo)
- Usar modais para formulÃ¡rios
- Implementar busca por nome do paciente/profissional

## ðŸŽ¯ PrÃ³ximos Passos

1. **Implementar no Frontend**: Use os exemplos fornecidos
2. **Testar Endpoints**: Use o Swagger UI em `/api/`
3. **Configurar PermissÃµes**: Integre com sistema de autenticaÃ§Ã£o
4. **Adicionar NotificaÃ§Ãµes**: Implemente alertas para mudanÃ§as de status
5. **RelatÃ³rios**: Crie dashboards com estatÃ­sticas dos vÃ­nculos

---

**ðŸ“ž Suporte**: Para dÃºvidas sobre implementaÃ§Ã£o, consulte a documentaÃ§Ã£o da API em `/api/` ou entre em contato com a equipe de desenvolvimento.
